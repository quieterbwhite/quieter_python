# Mysql 高可用

## 什么是高可用架构
```
全年可用时间, 0.99999
```

## 如何实现高可用
```
避免导致系统不可用的因素, 减少系统不可用时间

    1. 建立完善的监控及报警系统
    2. 对备份数据进行恢复测试(定时测试)
    3. 正确配置数据库
    4. 对不需要的数据进行归档和清理(独立的表空间)

增加系统冗余，保证发生系统不可用时可以尽快恢复

    1. 避免存在单点故障

        利用SUN共享存储(不是好的方式)或DRDB磁盘复制解决MySQL单点故障

        利用多写集群或NDB集群来解决MySQL单点故障

        利用mysql主从复制来解决MySQL单点故障

        如何解决主服务器的单点问题：

            主服务器切换后如何通知应用新的主服务器的IP地址

            如何检查MySQL主服务器是否可用

            如何处理从服务器和新主服务器之间的那种复制关系

    2. 主从切换及故障转移

MMM(Multi-Master Replication Manager)

    主要作用:
        监控和管理MySQL的主主复制拓扑，并在当前的主服务器失效时，
        进行主和主备服务器之间的主从切换和故障转移工作。

    提供的功能:
        MMM监控MySQL主从复制健康状况
            主动主动模式的主主复制，两个主同时对外提供服务
            主动被动模式的主主复制，同时只有一个主数据库对外提供服务，另一个处于备用状态。MMM工作在这种模式下

        在主库出现宕机时进行故障转移并自动配置其他从对新主的复制
            如何找到从库对应的新的主库日志点的日志同步点
            如果存在多个从库出现数据不一致的情况如何处理
            在一个繁忙的系统，MMM对以上情况处理不够理想，可能会出现数据丢失情况

        提供了主，写虚拟ip， 在主服务器出现问题时可以自动迁移虚拟ip

    MMM架构

        主服务器

        主服务器(虚线)

        从，从，从。。

        MMM监控服务器

    MMM 部署所需资源有哪些

        ![MMM 资源](quieter_python/static/image/mysql/mysql_mmm_setup_env.jpg)
        ![cmd-markdown-logo](https://raw.githubusercontent.com/quieterbwhite/quieter_python/master/static/image/mysql/mysql_mmm_setup_env.jpg)

```
