# 亿级流量网站架构核心技术

## 基于 Servlet 3 实现请求隔离
```
Tomcat 在收到 HTTP 请求后会按照如下流程处理请求:

    1. 容器负责接收并请求为 HttpServletRequest.
    2. 然后交给 Servlet 进行业务处理.
    3. 最后通过 HttpServletResponse 写出响应.

在 Servlet2.x 规范中，所有这些处理都是同步进行的，也就是说必须在一个线程中完成从接收请求，业务处理到响应.

请求异步化的好处:

    1. 基于 NIO 能处理更高的并发连接数
    2. 请求解析业务处理线程池分离
    3. 根据业务重要性对业务分级，并分级线程池
    4. 对业务线程池进行监控，运维，降级等处理

Servlet 3 之前的线程模型:

    整个请求解析，业务处理，生成响应都是由 Tomcat 线程池进行处理的，
    而且都是在一个线程中处理，不能分离线程处理，
    比如接收到请求后交给其他线程处理，则不能灵活定义业务处理模型。

Servlet3 之后的线程模型:

    请求解析使用 Tomcat 单线程，而解析完成后会将请求仍到业务队列中，
    由业务线程进行处理，这种处理方式可以得到如下好处:

        1. 根据业务重要性对业务进行分级，然后根据分级定义线程池
        2. 可以拿到业务线程池，可以进行很多操作，比如监控，降级等。
```
